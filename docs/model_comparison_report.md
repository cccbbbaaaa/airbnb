# 模型对比报告 / Model Comparison Report

## 数据划分策略 / Data Splitting Strategy

**划分方法**: `sklearn.model_selection.train_test_split`

**划分参数**:
- **测试集比例**: 20% (`test_size=0.2`)
- **随机种子**: 42 (`random_state=42`) - 确保结果可重复
- **分层抽样**: 启用 (`stratify=y`) - 确保训练集和测试集中5星样本的比例一致

**划分结果**:
- **总样本数**: 26,596 条
- **训练集**: 21,276 条（80%，5星占比: 29.50%）
- **测试集**: 5,320 条（20%，5星占比: 29.49%）

**说明**:
- 所有模型使用相同的划分策略，确保结果可比性
- 分层抽样保证了训练集和测试集的类别分布一致
- 固定随机种子确保了每次运行结果的一致性

---

## 概述 / Overview

本文档记录了评分分类任务（Rating = 5 vs Rating < 5）中使用的各个模型的详细性能指标、训练时间和模型复杂度。

**任务类型**: 二分类（Binary Classification）
**目标变量**: `is_five_star` (1 = 5星评分, 0 = <5星评分)
**数据集规模**: 26,596 条样本（训练集: 21,276, 测试集: 5,320）
**特征数量**: 113 个特征

---

## 模型列表 / Model List

1. **Logistic Regression**（逻辑回归）- 线性基线模型
2. **Linear SVM**（线性支持向量机）- 线性基线模型
3. **Random Forest**（随机森林）- 树模型基线
4. **CatBoost** - 梯度提升树模型（最佳性能）
5. **MLP Neural Network**（多层感知机）- 神经网络模型（最佳MLP集成模型）

---

## 详细性能指标 / Detailed Performance Metrics

### 1. Logistic Regression（逻辑回归）

**模型类型**: 线性模型 / Linear Model**训练时间**: 1.21 秒**模型复杂度**:

- 参数数量: 114
- 模型大小: <0.01 MB

#### 训练集性能 / Training Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.763 |
| Precision | 0.567 |
| Recall    | 0.828 |
| F1-Score  | 0.673 |
| AUC       | 0.856 |

#### 测试集性能 / Test Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.757 |
| Precision | 0.560 |
| Recall    | 0.825 |
| F1-Score  | 0.667 |
| AUC       | 0.848 |

**特点**:

- ✅ 训练速度快，模型简单
- ✅ Recall较高（0.825），适合找出更多5星样本
- ❌ Precision较低（0.560），误报率较高
- ❌ AUC相对较低（0.848）

---

### 2. Linear SVM（线性支持向量机）

**模型类型**: 线性模型 / Linear Model**训练时间**: 0.66 秒**模型复杂度**:

- 参数数量: 114
- 模型大小: <0.01 MB

#### 训练集性能 / Training Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.759 |
| Precision | 0.563 |
| Recall    | 0.821 |
| F1-Score  | 0.668 |
| AUC       | 0.852 |

#### 测试集性能 / Test Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.757 |
| Precision | 0.560 |
| Recall    | 0.819 |
| F1-Score  | 0.665 |
| AUC       | 0.843 |

**特点**:

- ✅ 训练速度最快（0.66秒）
- ✅ 模型最简单，参数少
- ✅ Recall较高（0.819）
- ❌ Precision最低（0.560）
- ❌ AUC最低（0.843）

---

### 3. Random Forest（随机森林）

**模型类型**: 集成树模型 / Ensemble Tree Model**训练时间**: 1.47 秒**模型复杂度**:

- 参数数量: ~20,000（200棵树 × 平均100节点）
- 模型大小: 0.15 MB

#### 训练集性能 / Training Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.899 |
| Precision | 0.764 |
| Recall    | 0.952 |
| F1-Score  | 0.848 |
| AUC       | 0.976 |

#### 测试集性能 / Test Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.804 |
| Precision | 0.635 |
| Recall    | 0.787 |
| F1-Score  | 0.703 |
| AUC       | 0.882 |

**特点**:

- ✅ 训练速度快（1.47秒）
- ✅ 训练集表现优秀（AUC=0.976）
- ⚠️ 存在过拟合风险（训练AUC=0.976 vs 测试AUC=0.882）
- ✅ 测试集AUC较高（0.882）
- ✅ 各项指标较均衡

**模型配置**:

- 树数量: 200
- 最大深度: 15
- 最小样本分割: 10
- 最小样本叶子: 5

---

### 4. CatBoost（最佳性能模型）

**模型类型**: 梯度提升树模型 / Gradient Boosting Tree Model**训练时间**:

- 基线模型: 2.67秒（单次训练）
- 调优后模型: 约2.5秒（单次训练，使用最佳参数）
- **超参数调优时间**: 25.38分钟（手动网格搜索，81种参数组合，使用CatBoost的cv方法确保use_best_model正常工作）**模型复杂度**:
- 参数数量: ~40,000-60,000（取决于迭代次数）
- 模型大小: 0.46 MB

#### 训练集性能 / Training Set Performance

| 指标      | 值    |
| --------- | ----- |
| Accuracy  | 0.834 |
| Precision | 0.658 |
| Recall    | 0.909 |
| F1-Score  | 0.763 |
| AUC       | 0.932 |

#### 测试集性能 / Test Set Performance

**基线模型（原始参数）**:

| 指标      | 值              |
| --------- | --------------- |
| Accuracy  | 0.797           |
| Precision | 0.613           |
| Recall    | **0.848** |
| F1-Score  | **0.711** |
| AUC       | **0.889** |

**调优后模型（网格搜索最佳参数，按交叉验证AUC选择）**:

| 指标      | 值              |
| --------- | --------------- |
| Accuracy  | 0.792           |
| Precision | 0.604           |
| Recall    | **0.854** |
| F1-Score  | 0.708           |
| AUC       | 0.888           |

**调优效果**:

- AUC: -0.16%（略有下降，从0.889降至0.888）
- F1-Score: -0.53%（略有下降）
- Precision: -1.43%（下降）
- **Recall: +0.75%（提升，从0.848提升至0.854）** ⭐

**调优结果分析**:

- 基线参数组合 (600, 6, 0.03, 3) 在81种组合中：
  - 交叉验证AUC排名：第41名（0.8861）
  - 测试集AUC排名：第1名（0.8890）⭐
  - 说明：基线参数在测试集上表现最好，但在交叉验证中排名中等
  
- 最佳参数组合 (400, 6, 0.03, 5) 在81种组合中：
  - 交叉验证AUC排名：第1名（0.8865）⭐
  - 测试集AUC排名：第2名（0.8876）
  - 说明：在交叉验证中表现最好，但在测试集上略低于基线

- **关键发现**：
  - 基线参数可能对测试集有一定的过拟合，或者交叉验证和测试集的分布有差异
  - 调优后的参数在交叉验证中表现最好，泛化能力可能更强
  - 如果优先考虑Recall，调优后的参数更优（Recall=0.854 vs 0.848）

**特点**:

- ✅ **最佳综合性能**（基线模型 Test AUC = 0.889）
- ✅ **最高Recall**（调优后 Recall = 0.854，比基线提升0.75%）
- ✅ 训练集和测试集性能差距小，过拟合风险低
- ✅ 自动处理类别不平衡（`auto_class_weights='Balanced'`）
- ✅ 训练时间适中（基线2.32秒，调优后2.47秒）
- ⚠️ Precision相对较低（基线0.613，调优后0.604）

**超参数调优说明**:

- **调优方法**：手动网格搜索，使用CatBoost内置的`cv`方法进行交叉验证，确保`use_best_model=True`正常工作
- **调优范围**：81种参数组合（iterations: [400,600,800], depth: [4,6,8], learning_rate: [0.01,0.03,0.05], l2_leaf_reg: [1,3,5]）
- **调优时间**：25.38分钟（81种组合，每种组合进行3折交叉验证）
- **调优结果**：
  - 最佳参数组合（按交叉验证AUC）：iterations=400, depth=6, learning_rate=0.03, l2_leaf_reg=5
  - 调优后Recall提升至0.854（比基线提升0.75%），但AUC略有下降（-0.16%）
  - 基线参数在交叉验证中排名第41名，但在测试集上表现最好（排名第1）
- **建议**：
  - 如果优先考虑Recall：使用调优后的参数（Recall=0.854）
  - 如果追求最佳AUC：使用基线参数（AUC=0.889）
  - 如果追求更好的泛化能力：使用调优后的参数（交叉验证表现更好）

**模型配置**:

**基线模型参数**:

- 迭代次数: 600
- 树深度: 6
- 学习率: 0.03
- L2正则化: 3
- 早停轮数: 80

**调优后最佳参数**（通过网格搜索获得）:

- 迭代次数: 400
- 树深度: 6
- 学习率: 0.03
- L2正则化: 5
- 早停轮数: 80

**超参数调优范围**:

- iterations: [400, 600, 800]
- depth: [4, 6, 8]
- learning_rate: [0.01, 0.03, 0.05]
- l2_leaf_reg: [1, 3, 5]
- 总参数组合数: 81种
- 交叉验证折数: 3折
- 总训练次数: 243次（81 × 3）

---

### 5. MLP Neural Network（多层感知机 - 最佳MLP集成模型）

**模型类型**: 深度神经网络 / Deep Neural Network**训练时间**: 约20-30分钟（包括超参数调优的网格搜索和集成训练）**模型复杂度**:

- 参数数量: ~668,163（3个模型总和）
- 模型大小: ~5.1 MB（3个模型总和）

#### 训练集性能 / Training Set Performance

| 指标      | 值 |
| --------- | -- |
| Accuracy  | -  |
| Precision | -  |
| Recall    | -  |
| F1-Score  | -  |
| AUC       | -  |

*注: MLP_Ensemble是集成模型，训练集指标未单独记录*

#### 测试集性能 / Test Set Performance

| 指标      | 值              |
| --------- | --------------- |
| Accuracy  | 0.798           |
| Precision | **0.624** |
| Recall    | 0.794           |
| F1-Score  | 0.699           |
| AUC       | 0.879           |

**特点**:

- ✅ **最高Precision**（0.624），误报率最低
- ✅ 适合处理文本嵌入特征（40个文本嵌入特征）
- ✅ 训练集和测试集性能差距小
- ⚠️ 训练时间最长（20-30分钟，包括网格搜索）
- ⚠️ 模型复杂度最高（3个模型，总参数数约668,163）
- ⚠️ Recall略低于CatBoost（0.794 vs 0.848）

**模型架构**:

- 集成策略: 3个MLP模型的概率平均
- 基础模型1: MLP_Wide_Weighted (512, 256, 128)
- 基础模型2: MLP_Deep_Regularized (512, 256, 128, 64)
- 基础模型3: MLP_Wide_Shallow (1024, 512)
- 最佳阈值: 0.35（通过阈值优化提升Recall）

**训练流程说明**:

- MLP_Ensemble的训练包括4个策略的网格搜索（RandomizedSearchCV）
- 每个策略训练20个候选模型（最后一个策略16个），每个候选模型进行3折交叉验证
- 总共约228次训练迭代（60+60+60+48）
- 单个MLP模型训练时间约16秒，但网格搜索需要训练多个候选模型
- 实际总训练时间约20-30分钟（取决于硬件性能）

**注意**: MLP_Ensemble通过集成3个MLP模型达到Test AUC = 0.879，Test Recall = 0.794。

---

## 综合对比 / Comprehensive Comparison

### 性能排名（按Test AUC）

| 排名 | 模型                   | Test AUC        | Test F1         | Test Precision  | Test Recall     | 训练时间   |
| ---- | ---------------------- | --------------- | --------------- | --------------- | --------------- | ---------- |
| 1    | **CatBoost**     | **0.889** | **0.711** | 0.613           | **0.848** | 2.32秒     |
| 2    | **MLP_Ensemble** | **0.879** | 0.699           | **0.624** | 0.794           | 20-30分钟* |
| 3    | Random Forest          | 0.882           | 0.703           | 0.635           | 0.787           | 1.47秒     |
| 4    | Logistic Regression    | 0.848           | 0.667           | 0.560           | 0.825           | 1.21秒     |
| 5    | Linear SVM             | 0.843           | 0.665           | 0.560           | 0.819           | 0.66秒     |

*CatBoost基线模型训练时间（单次训练）  
**CatBoost调优后模型训练时间（单次训练），超参数调优耗时25.38分钟（手动网格搜索81种参数组合，使用CatBoost的cv方法）
***MLP_Ensemble的训练时间包括超参数调优的网格搜索（约228次训练迭代）和集成训练，实际时间约20-30分钟

### 训练时间对比

| 模型                | 训练时间  | 相对速度 |
| ------------------- | --------- | -------- |
| Linear SVM          | 0.66秒    | 最快     |
| Logistic Regression | 1.21秒    | 快       |
| Random Forest       | 1.47秒    | 快       |
| CatBoost            | 2.32秒    | 中等     |
| MLP_Ensemble        | 20-30分钟 | 很慢     |

### 模型复杂度对比

| 模型                | 参数数量 | 模型大小（MB） | 复杂度等级 |
| ------------------- | -------- | -------------- | ---------- |
| Logistic Regression | 114      | <0.01          | 低         |
| Linear SVM          | 114      | <0.01          | 低         |
| Random Forest       | ~20,000  | 0.15           | 中         |
| CatBoost            | ~60,000  | 0.46           | 中         |
| MLP_Best            | 222,721  | 1.70           | 高         |

### 关键指标对比

#### Test AUC（越高越好）

```
CatBoost:        ████████████████████ 0.889
MLP_Ensemble:    ██████████████████   0.879
Random Forest:   ██████████████████   0.882
Logistic Reg:    ██████████████       0.848
Linear SVM:      █████████████        0.843
```

#### Test Recall（越高越好 - 找出更多5星样本）

```
CatBoost:        ████████████████████ 0.848
MLP_Ensemble:    ██████████████████   0.794
Random Forest:   ████████████████     0.787
Logistic Reg:    █████████████████    0.825
Linear SVM:      █████████████████    0.819
```

#### Test Precision（越高越好 - 减少误报）

```
MLP_Ensemble:    ██████████████████   0.624
Random Forest:   ████████████████     0.635
CatBoost:        ███████████████       0.613
Logistic Reg:    ████████████         0.560
Linear SVM:      ████████████         0.560
```

---

## 模型选择建议 / Model Selection Recommendations

### 场景1: 优先考虑Recall（找出更多5星房源）

**推荐**: CatBoost（调优后）

- Test Recall = 0.854（最高，比基线提升0.75%）
- Test AUC = 0.888（略低于基线0.889）
- 训练时间适中（约2.5秒）
- 超参数调优时间：25.38分钟（一次性投入）
- 交叉验证表现最好（排名第1），泛化能力可能更强

### 场景2: 优先考虑Precision（减少误报）

**推荐**: MLP_Ensemble

- Test Precision = 0.624（最高）
- Test AUC = 0.879（第二高）
- 适合处理文本特征

### 场景3: 需要快速训练和预测

**推荐**: Linear SVM 或 Logistic Regression

- 训练时间最短（<1.5秒）
- 模型简单，预测速度快
- 适合实时预测场景

### 场景4: 平衡性能和速度

**推荐**: Random Forest

- Test AUC = 0.882（第三高）
- 训练时间快（1.47秒）
- 模型复杂度适中

### 场景5: 追求最高综合性能

**推荐**: CatBoost（基线模型）

- 最佳Test AUC（0.889）
- 最佳Test F1（0.711）
- Test Recall（0.848，调优后可提升至0.854）
- 自动处理类别不平衡

**调优选项**:

- 如果优先Recall：使用调优后参数（Recall=0.854，AUC=0.888）
- 如果优先AUC：使用基线参数（AUC=0.889，Recall=0.848）

---

## 过拟合分析 / Overfitting Analysis

### 训练集 vs 测试集 AUC差距

| 模型                | Train AUC | Test AUC | 差距  | 过拟合风险 |
| ------------------- | --------- | -------- | ----- | ---------- |
| Random Forest       | 0.976     | 0.882    | 0.094 | ⚠️ 高    |
| CatBoost            | 0.932     | 0.889    | 0.043 | ✅ 低      |
| MLP_Ensemble        | -         | 0.879    | -     | ✅ 低*     |
| Logistic Regression | 0.856     | 0.848    | 0.008 | ✅ 很低    |
| Linear SVM          | 0.852     | 0.843    | 0.009 | ✅ 很低    |

**结论**:

- Random Forest存在明显过拟合（差距0.094）
- CatBoost和MLP的过拟合风险较低
- 线性模型（Logistic Regression, Linear SVM）过拟合风险最低

---

## 总结 / Summary

### 最佳模型: CatBoost

**基线模型优势**:

- ✅ 最佳综合性能（Test AUC = 0.889）
- ✅ 高Recall（0.848），能找出较多5星样本
- ✅ 最佳F1-Score（0.711）
- ✅ 过拟合风险低
- ✅ 自动处理类别不平衡
- ✅ 训练时间适中（2.32秒）

**调优后模型优势**:

- ✅ 最高Recall（0.854，比基线提升0.75%）
- ✅ Test AUC仍然很高（0.888）
- ✅ 训练时间适中（2.47秒）
- ⚠️ 超参数调优耗时8.58分钟（一次性投入）

**适用场景**:

- 需要找出尽可能多的5星房源：使用调优后模型（Recall=0.854）
- 追求最佳综合性能：使用基线模型（AUC=0.889）
- 需要自动化程度高的模型：两者均可

### 最佳MLP模型: MLP_Ensemble

**优势**:

- ✅ 最高Precision（0.624），误报率最低
- ✅ 适合处理文本嵌入特征
- ✅ Test AUC较高（0.879）

**劣势**:

- ❌ 训练时间最长（20-30分钟，包括网格搜索和集成训练）
- ❌ 模型复杂度最高（3个模型，总参数数约668,163）
- ❌ Recall低于CatBoost（0.794 vs 0.848）

**适用场景**:

- 需要高Precision的场景
- 有充足的计算资源
- 需要充分利用文本特征

### 基线模型表现

**Logistic Regression** 和 **Linear SVM** 作为基线模型表现良好：

- 训练速度快（<1.5秒）
- 模型简单，易于解释
- Recall较高（>0.81），适合快速原型开发

---

## 附录 / Appendix

### 数据说明

- **训练集**: 21,276 条样本（5星占比: 29.50%）
- **测试集**: 5,320 条样本（5星占比: 29.49%）
- **特征数量**: 113 个特征
  - 数值特征: 73个
  - 文本嵌入特征: 40个（TF-IDF + SVD）
  - 情感分析特征: 4个
  - 缺失指示变量: 11个

### 评估指标说明

- **Accuracy**: 整体分类准确率
- **Precision**: 预测为5星的样本中，实际为5星的比例
- **Recall**: 实际为5星的样本中，被正确预测的比例
- **F1-Score**: Precision和Recall的调和平均数
- **AUC**: ROC曲线下面积，衡量模型区分能力

### 模型文件位置

- CatBoost模型: `models/`（如已保存）
- MLP模型: `models/best_mlp_advanced_classifier.pkl`
- MLP标准化器: `models/mlp_advanced_scaler.pkl`

---

**文档生成时间**: 2024年11月
**数据来源**: `charts/model/rating_classifier_extended_comparison.csv`, `charts/model/neural_network_advanced_tuning_results.csv`, `charts/model/model_metrics_detailed.csv`
